#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Configuration Management - AI Coding Brain MCP
Claude Desktop ì„¤ì • ê´€ë¦¬

ì‘ì„±ì¼: 2025-06-20
"""

import os
import json
from pathlib import Path

# ===========================================
# Claude Desktop ì„¤ì • ê´€ë¦¬
# ===========================================

def get_paths_from_config() -> dict:
    """ê²½ë¡œ ì„¤ì • ê°€ì ¸ì˜¤ê¸° - config.jsonê³¼ Claude Desktop ì„¤ì • ë³‘í•©"""
    import os
    import json
    from pathlib import Path
    
    # ê¸°ë³¸ê°’ ì„¤ì •
    paths = {
        'project_path': Path.home() / "Desktop",
        'desktop_path': Path.home() / "Desktop",  # desktop_path ì¶”ê°€
        'memory_root': Path.home() / "Desktop" / "memory",
        'workspace_dirs': []
    }
    
    # 1. í”„ë¡œì íŠ¸ì˜ config.json ì½ê¸°
    project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
    config_json_path = os.path.join(project_root, "config.json")
    
    if os.path.exists(config_json_path):
        try:
            with open(config_json_path, 'r', encoding='utf-8') as f:
                project_config = json.load(f)
                
            # config.jsonì˜ ì„¤ì • ì ìš©
            if 'desktop_path' in project_config:
                paths['desktop_path'] = Path(project_config['desktop_path'])
                paths['project_path'] = Path(project_config['desktop_path'])  # project_pathë„ ë™ì¼í•˜ê²Œ
                
            if 'workspace_dirs' in project_config:
                paths['workspace_dirs'] = project_config['workspace_dirs']
                
        except Exception as e:
            print(f"âš ï¸ config.json ë¡œë“œ ì‹¤íŒ¨: {e}")
    
    # 2. Claude Desktop ì„¤ì • ì½ê¸° (ê¸°ì¡´ ë¡œì§)
    claude_config_path = os.path.expanduser("~/AppData/Roaming/Claude/claude_desktop_config.json")
    
    if os.path.exists(claude_config_path):
        try:
            with open(claude_config_path, 'r', encoding='utf-8') as f:
                claude_config = json.load(f)
            
            mcp_servers = claude_config.get('mcpServers', {})
            for server_name, server_config in mcp_servers.items():
                if 'ai-coding-brain' in server_name.lower():
                    env = server_config.get('env', {})
                    if 'PROJECT_ROOT' in env:
                        # Claude ì„¤ì •ì´ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
                        paths['project_path'] = Path(env['PROJECT_ROOT'])
                        paths['desktop_path'] = Path(env['PROJECT_ROOT'])
                    if 'MEMORY_BANK_ROOT' in env:
                        paths['memory_root'] = Path(env['MEMORY_BANK_ROOT'])
                    break
        except Exception as e:
            print(f"âš ï¸ Claude Desktop ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: {e}")
    
    # ê²½ë¡œ í™•ì¸ ë¡œê·¸
    print(f"ğŸ“ ê²½ë¡œ ì„¤ì •:")
    print(f"   desktop_path: {paths['desktop_path']}")
    print(f"   memory_root: {paths['memory_root']}")
    
    return paths




