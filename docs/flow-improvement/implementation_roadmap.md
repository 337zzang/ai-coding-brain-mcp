# Flow 시스템 개선 구현 로드맵

## 구현 우선순위

### Phase 1: 기반 구축 (1-2일)
1. **ProjectContext 구현**
   - 클래스 구현
   - 단위 테스트
   - 문서화

2. **테스트 환경 구축**
   - pytest 설정
   - 테스트 디렉토리 구조
   - CI 파이프라인 (선택)

### Phase 2: Repository 레이어 (2-3일)
1. **JsonFlowRepository 개선**
   - ProjectContext 통합
   - set_context 메서드 추가
   - 동적 경로 지원

2. **마이그레이션 헬퍼**
   - 기존 flows.json 마이그레이션
   - 백업 및 복원 기능

### Phase 3: Service 레이어 (2-3일)
1. **FlowService 개선**
   - 전역 파일 제거
   - ProjectContext 기반 current_flow
   - 캐시 개선

2. **PlanService/TaskService 업데이트**
   - ProjectContext 인식
   - 경로 독립성 확보

### Phase 4: 통합 및 테스트 (3-4일)
1. **FlowManagerUnified 개선**
   - for_project 팩토리 메서드
   - switch_project 메서드
   - 레거시 호환성 레이어

2. **통합 테스트**
   - 프로젝트 전환 시나리오
   - 멀티 프로젝트 동시 작업
   - 성능 테스트

### Phase 5: 배포 및 문서화 (1-2일)
1. **배포 준비**
   - 변경 로그 작성
   - 마이그레이션 가이드
   - API 문서 업데이트

2. **사용자 가이드**
   - 새 기능 사용법
   - 문제 해결 가이드
   - FAQ

## 일정표

| 주차 | 작업 내용 | 산출물 |
|------|----------|--------|
| 1주차 | Phase 1-2 | ProjectContext, Repository 개선 |
| 2주차 | Phase 3-4 | Service 개선, 통합 테스트 |
| 3주차 | Phase 5 | 배포, 문서화 |

## 위험 관리

### 높은 위험
- **데이터 손실**: flows.json 마이그레이션 중 오류
  - 대응: 자동 백업, 트랜잭션 처리

### 중간 위험  
- **호환성 문제**: 기존 코드와 충돌
  - 대응: 점진적 마이그레이션, 호환성 레이어

### 낮은 위험
- **성능 저하**: 경로 연산 오버헤드
  - 대응: 프로파일링, 최적화

## 성공 지표

1. **기능적 지표**
   - [ ] 프로젝트별 독립적 flows.json
   - [ ] 런타임 프로젝트 전환
   - [ ] 기존 API 100% 호환

2. **품질 지표**
   - [ ] 테스트 커버리지 80% 이상
   - [ ] 성능 저하 5% 미만
   - [ ] 문서화 완료

3. **사용성 지표**
   - [ ] 프로젝트 전환 시간 < 100ms
   - [ ] 에러 메시지 명확성
   - [ ] 마이그레이션 자동화

## 체크포인트

### CP1: ProjectContext 완료
- 클래스 구현 완료
- 테스트 통과
- 문서 작성

### CP2: Repository 개선 완료
- 동적 경로 지원
- 마이그레이션 테스트
- 성능 확인

### CP3: 전체 통합 완료
- 모든 컴포넌트 통합
- E2E 테스트 통과
- 사용자 피드백

## 다음 단계

1. ProjectContext 구현 시작
2. 테스트 환경 설정
3. 첫 번째 PR 준비
