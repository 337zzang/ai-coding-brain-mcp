"""
ğŸ¤– í´ë¡œë“œì½”ë“œ í†µí•© AI Brain ì‹œìŠ¤í…œ v2.0
=======================================

í´ë¡œë“œì½”ë“œ execute_code í™˜ê²½ì„ ìœ„í•œ ì™„ì „ í†µí•© AI ë‘ë‡Œ ì‹œìŠ¤í…œ
- ë¦¬íŒ©í† ë§ëœ context_managerì™€ vibe_memory_system í†µí•©
- ìë™ ì„¸ì…˜ ë³µì›
- í”„ë¡œì íŠ¸ ê´€ë¦¬  
- ì§€ì‹ ë² ì´ìŠ¤
- ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ í†µí•©

ì‘ì„±ì: Claude + ì‚¬ìš©ì í˜‘ì—…
ìƒì„±ì¼: 2025-06-04
ìˆ˜ì •ì¼: 2025-06-12 (v2.0 - ëª¨ë“ˆ êµ¬ì¡° ê°œì„ )
"""

import os
import json
import logging
import datetime as dt
from pathlib import Path
from typing import Union, Optional, Dict, Any
import sys

# Auto-tracking wrapper import
try:
    from auto_tracking_wrapper import *
    print("âœ… ìë™ ì¶”ì  ë˜í¼ ë¡œë“œ - ëª¨ë“  íŒŒì¼ ì‘ì—…ì´ ìë™ìœ¼ë¡œ ì¶”ì ë©ë‹ˆë‹¤")
except ImportError:
    print("âš ï¸ ìë™ ì¶”ì  ë˜í¼ ë¡œë“œ ì‹¤íŒ¨ - ì›ë³¸ ëª¨ë“ˆ ì‚¬ìš©")
    from file_system_helpers import *
    from ast_parser_helpers import *

# Context Manager ê³µê°œ API import
try:
    from context_manager import (
        initialize_context,
        save_context,
        update_cache,
        get_value,
        find_symbol,
        track_file_access,
        track_function_edit,
        get_work_tracking_summary
    )
    CONTEXT_MANAGER_AVAILABLE = True
    print("âœ… Context Manager v2.0 ë¡œë“œ ì™„ë£Œ")
except ImportError as e:
    CONTEXT_MANAGER_AVAILABLE = False
    print(f"âš ï¸ Context Manager ë¡œë“œ ì‹¤íŒ¨: {e}")

# Vibe Memory System ê³µê°œ API import
try:
    from vibe_memory_system import (
        sync_to_files,
        auto_save,
        force_sync,
        save_coding_experience,
        search_coding_solutions,
        get_coding_insights
    )
    VIBE_MEMORY_AVAILABLE = True
    print("âœ… Vibe Memory System v2.0 ë¡œë“œ ì™„ë£Œ")
except ImportError as e:
    VIBE_MEMORY_AVAILABLE = False
    print(f"âš ï¸ Vibe Memory System ë¡œë“œ ì‹¤íŒ¨: {e}")

# Vibe ë‚´ë¶€ í•¨ìˆ˜ë“¤ (í•„ìš”ì‹œ)
try:
    import vibe_memory_system
    VIBE_MODULE_AVAILABLE = True
except ImportError:
    vibe_memory_system = None
    VIBE_MODULE_AVAILABLE = False


class SimpleLogger:
    """ê°„ë‹¨í•œ ë¡œê±° í´ë˜ìŠ¤ - ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥"""
    def info(self, msg): print(f"[INFO] {msg}")
    def warning(self, msg): print(f"[WARNING] {msg}")
    def error(self, msg): print(f"[ERROR] {msg}")
    def debug(self, msg): print(f"[DEBUG] {msg}")


class ClaudeCodeAIBrain:
    """
    í´ë¡œë“œì½”ë“œ í™˜ê²½ì„ ìœ„í•œ ì™„ì „ í†µí•© AI ë‘ë‡Œ ì‹œìŠ¤í…œ v2.0
    - ë¦¬íŒ©í† ë§ëœ ëª¨ë“ˆ êµ¬ì¡° í†µí•©
    - ìë™ ì„¸ì…˜ ë³µì› + í”„ë¡œì íŠ¸ ê´€ë¦¬ + ì§€ì‹ ë² ì´ìŠ¤ + ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ
    """
    
    def __init__(self, project_path: Optional[str] = None):
        """AI Brain ì´ˆê¸°í™” - v2.0"""
        # ê¸°ë³¸ ì†ì„± ì´ˆê¸°í™”
        self.initialized: bool = False
        self.project_context: Optional[Dict[str, Any]] = None
        self.session_manager: Dict[str, Any] = {}
        self.task_manager: Dict[str, Any] = {}
        self.vibe_manager = None
        self.vibe_commands = None
        self.hierarchical_manager = None
        self.knowledge_manager = None
        self.memory_systems: Dict[str, Any] = {}
        
        # logger ì´ˆê¸°í™”
        self.logger = self._setup_logger()
        
        # project_path ì´ˆê¸°í™”
        if project_path:
            self.project_path = os.path.abspath(project_path)
        else:
            self.project_path = os.path.dirname(os.path.abspath(__file__))
        
        self.logger.info(f"ClaudeCodeAIBrain v2.0 ì´ˆê¸°í™” - í”„ë¡œì íŠ¸ ê²½ë¡œ: {self.project_path}")
        self.session_file_path = os.path.join(self.project_path, 'session_cache', 'latest_session.json')
    
    def _setup_logger(self) -> Union[logging.Logger, SimpleLogger]:
        """ë¡œê±° ì„¤ì •"""
        try:
            logger = logging.getLogger('ClaudeCodeAIBrain')
            
            if logger.handlers:
                return logger
            
            logger.setLevel(logging.INFO)
            console_handler = logging.StreamHandler()
            console_handler.setLevel(logging.INFO)
            
            formatter = logging.Formatter(
                '[%(asctime)s] %(name)s - %(levelname)s: %(message)s',
                datefmt='%H:%M:%S'
            )
            console_handler.setFormatter(formatter)
            logger.addHandler(console_handler)
            
            return logger
            
        except Exception as e:
            print(f"Logger ì„¤ì • ì‹¤íŒ¨, ê¸°ë³¸ ì¶œë ¥ ëª¨ë“œ: {e}")
            return SimpleLogger()

    def auto_initialize(self, project_path: Optional[str] = None, force_reinit: bool = False) -> bool:
        """AI Brain ìë™ ì´ˆê¸°í™” - v2.0"""
        try:
            self.logger.info("=== AI Brain v2.0 ì´ˆê¸°í™” ì‹œì‘ ===")
            
            # project_path ì—…ë°ì´íŠ¸
            if project_path:
                self.project_path = os.path.abspath(project_path)
                self.logger.info(f"í”„ë¡œì íŠ¸ ê²½ë¡œ ì—…ë°ì´íŠ¸: {self.project_path}")
            
            # 1. Context Managerë¥¼ í†µí•œ ì´ˆê¸°í™”
            if CONTEXT_MANAGER_AVAILABLE:
                self.logger.info("Context Manager v2.0 ì‚¬ìš©í•˜ì—¬ ì´ˆê¸°í™”...")
                project_name = os.path.basename(self.project_path)
                
                # ìƒˆ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
                self.project_context = initialize_context(self.project_path, project_name)
                
                # AI Brain ìƒíƒœ ì—…ë°ì´íŠ¸
                update_cache(self.project_context, 'ai_brain_status', 'initializing')
                update_cache(self.project_context, 'ai_brain_version', 'v2.0')
                
                self.logger.info(f"Context ì´ˆê¸°í™” ì™„ë£Œ - ì„¸ì…˜ ID: {self.project_context.get('session_id', 'unknown')}")
            else:
                # Context Manager ì—†ì´ ê¸°ë³¸ ì´ˆê¸°í™”
                self._initialize_minimal_context()
            
            # 2. Vibe Memory System ì´ˆê¸°í™”
            if VIBE_MODULE_AVAILABLE and self.project_context:
                self._initialize_vibe_system()
            
            # 3. ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”
            self._initialize_basic_components()
            
            # 4. ì´ˆê¸° ì„¸ì…˜ ë°±ì—…
            self._create_session_backup()
            
            # 5. ìƒíƒœ ì—…ë°ì´íŠ¸
            if CONTEXT_MANAGER_AVAILABLE and self.project_context:
                update_cache(self.project_context, 'ai_brain_status', 'active')
            
            self.logger.info("AI Brain v2.0 ì´ˆê¸°í™” ì™„ë£Œ")
            self.initialized = True
            return True
            
        except Exception as e:
            self.logger.error(f"AI Brain ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
            
            # ìµœì†Œ ëª¨ë“œë¡œ ì´ˆê¸°í™”
            try:
                self._initialize_minimal_mode()
                self.logger.info("ìµœì†Œ ëª¨ë“œë¡œ ì´ˆê¸°í™” ì™„ë£Œ")
                self.initialized = True
                return True
            except Exception as minimal_error:
                self.logger.error(f"ìµœì†Œ ëª¨ë“œ ì´ˆê¸°í™”ë„ ì‹¤íŒ¨: {minimal_error}")
                return False

    def _initialize_minimal_context(self):
        """ìµœì†Œí•œì˜ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”"""
        import uuid
        self.project_context = {
            'session_id': str(uuid.uuid4()),
            'project_name': os.path.basename(self.project_path),
            'project_path': self.project_path,
            'version': 'v2.0-minimal',
            'created_at': dt.datetime.now().isoformat(),
            'cache': {},
            'stats': {}
        }
        self.logger.info("ìµœì†Œ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ")

    def _initialize_vibe_system(self):
        """Vibe Memory System ì´ˆê¸°í™”"""
        try:
            if not VIBE_MODULE_AVAILABLE or not vibe_memory_system:
                self.logger.warning("Vibe Memory System ëª¨ë“ˆ ì‚¬ìš© ë¶ˆê°€")
                return
            
            # VibeMemoryManager ì´ˆê¸°í™”
            self.vibe_manager = vibe_memory_system.VibeMemoryManager(
                self.project_context,
                self.project_context.get('project_name', 'ai-coding-brain-mcp')
            )
            
            # VibeCommandSystem ì´ˆê¸°í™”
            self.vibe_commands = vibe_memory_system.VibeCommandSystem(self.project_context)
            
            self.logger.info("âœ… Vibe Memory System v2.0 ì´ˆê¸°í™” ì™„ë£Œ")
            self.logger.info("   ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´: /task, /flow, /done, /focus, /roadmap, /vision, /stats, help")
            
            # ëª…ë ¹ì–´ ì²˜ë¦¬ ë©”ì„œë“œ ì¶”ê°€
            def process_vibe_command(command_text: str) -> str:
                if self.vibe_commands:
                    return self.vibe_commands.execute(command_text)
                else:
                    return "âŒ Vibe system not initialized"
            
            self.process_vibe_command = process_vibe_command
            
        except Exception as e:
            self.logger.error(f"Vibe System ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")

    def _initialize_basic_components(self):
        """ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”"""
        self.session_manager = {
            "status": "active",
            "initialized": True,
            "version": "v2.0"
        }
        
        self.task_manager = {
            "status": "active",
            "initialized": True,
            "tasks": []
        }
        
        self.logger.info("ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ")

    def _create_session_backup(self):
        """ì„¸ì…˜ ë°±ì—… ìƒì„±"""
        try:
            # ì„¸ì…˜ ìºì‹œ ë””ë ‰í† ë¦¬ ìƒì„±
            session_cache_dir = os.path.join(self.project_path, 'session_cache')
            os.makedirs(session_cache_dir, exist_ok=True)
            
            # ì„¸ì…˜ ë°±ì—… ë°ì´í„°
            backup_data = {
                'session_id': self.project_context.get('session_id') if self.project_context else None,
                'timestamp': dt.datetime.now().isoformat(),
                'version': 'v2.0',
                'project_context': self.project_context,
                'status': 'active'
            }
            
            # ë°±ì—… íŒŒì¼ ì €ì¥
            backup_file = os.path.join(session_cache_dir, 'latest_session.json')
            with open(backup_file, 'w', encoding='utf-8') as f:
                json.dump(backup_data, f, ensure_ascii=False, indent=2)
            
            self.logger.info(f"ì„¸ì…˜ ë°±ì—… ìƒì„± ì™„ë£Œ: {backup_file}")
            
        except Exception as e:
            self.logger.warning(f"ì„¸ì…˜ ë°±ì—… ìƒì„± ì‹¤íŒ¨ (ë¬´ì‹œ): {e}")

    def _initialize_minimal_mode(self):
        """ìµœì†Œ ëª¨ë“œ ì´ˆê¸°í™”"""
        self._initialize_minimal_context()
        self.session_manager = {"status": "minimal"}
        self.task_manager = {"status": "minimal"}

    def save_session(self) -> bool:
        """ì„¸ì…˜ ì €ì¥"""
        try:
            # Context Managerë¥¼ í†µí•œ ì €ì¥
            if CONTEXT_MANAGER_AVAILABLE and self.project_context:
                save_context()
                self.logger.info("Context Managerë¥¼ í†µí•œ ì„¸ì…˜ ì €ì¥ ì™„ë£Œ")
            
            # Vibe Memory ë™ê¸°í™”
            if VIBE_MEMORY_AVAILABLE:
                sync_to_files()
                self.logger.info("Vibe Memory ë™ê¸°í™” ì™„ë£Œ")
            
            # ë°±ì—… ìƒì„±
            self._create_session_backup()
            
            return True
            
        except Exception as e:
            self.logger.error(f"ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨: {e}")
            return False

    def track_operation(self, operation_type: str, details: Dict[str, Any]):
        """ì‘ì—… ì¶”ì """
        if CONTEXT_MANAGER_AVAILABLE and self.project_context:
            if operation_type == 'file_access':
                track_file_access(self.project_context, details.get('file_path', ''), details.get('operation', 'read'))
            elif operation_type == 'function_edit':
                track_function_edit(
                    self.project_context,
                    details.get('file_path', ''),
                    details.get('function_name', ''),
                    details.get('class_name')
                )

    def save_experience(self, experience_data: Union[str, Dict[str, Any]]):
        """ê°œë°œ ê²½í—˜ ì €ì¥"""
        if VIBE_MEMORY_AVAILABLE:
            result = save_coding_experience(experience_data, self.project_context)
            self.logger.info(f"ê²½í—˜ ì €ì¥: {result}")

    def search_solutions(self, query: str, limit: int = 10) -> Dict[str, Any]:
        """í•´ê²°ì±… ê²€ìƒ‰"""
        if VIBE_MEMORY_AVAILABLE:
            return search_coding_solutions(query, self.project_context, limit=limit)
        return {"status": "error", "message": "Vibe Memory not available", "results": []}

    def get_insights(self) -> Dict[str, Any]:
        """ì½”ë”© ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ"""
        if VIBE_MEMORY_AVAILABLE:
            return get_coding_insights(self.project_context)
        return {"status": "error", "message": "Vibe Memory not available"}


class DummyAIBrain:
    """Fallback AI Brain - ClaudeCodeAIBrain ìƒì„± ì‹¤íŒ¨ì‹œ ì‚¬ìš©"""
    
    def __init__(self, project_path: Optional[str] = None):
        """ë”ë¯¸ AI Brain ì´ˆê¸°í™”"""
        self.initialized: bool = False
        self.project_context: Dict[str, Any] = {
            'name': 'dummy',
            'base_path': project_path or '.',
            'version': 'dummy'
        }
        self.session_manager: Dict[str, Any] = {'status': 'dummy'}
        self.task_manager: Dict[str, Any] = {'status': 'dummy'}
        self.vibe_manager = None
        self.vibe_commands = None
        self.logger = SimpleLogger()
        self.project_path: str = project_path or '.'
    
    def save_session(self) -> bool:
        """ë”ë¯¸ ì„¸ì…˜ ì €ì¥"""
        return True
    
    def process_vibe_command(self, command: str) -> str:
        """ë”ë¯¸ Vibe ëª…ë ¹ì–´ ì²˜ë¦¬"""
        return "Dummy AI Brain - Vibe commands not available"
    
    def save_experience(self, experience_data: Union[str, Dict[str, Any]]):
        """ë”ë¯¸ ê²½í—˜ ì €ì¥ ë©”ì„œë“œ"""
        self.logger.info("DummyAIBrain - save_experience called (no-op)")
        return {"status": "dummy", "message": "Experience not saved in dummy mode"}
    
    def track_operation(self, operation_type: str, details: Dict[str, Any]):
        """ë”ë¯¸ ì‘ì—… ì¶”ì """
        self.logger.info(f"DummyAIBrain - track_operation: {operation_type}")
    
    def search_solutions(self, query: str, limit: int = 10) -> Dict[str, Any]:
        """ë”ë¯¸ ì†”ë£¨ì…˜ ê²€ìƒ‰"""
        return {"status": "dummy", "message": "Search not available in dummy mode", "results": []}
    
    def get_insights(self) -> Dict[str, Any]:
        """ë”ë¯¸ ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ"""
        return {"status": "dummy", "message": "Insights not available in dummy mode"}


def create_ai_brain(project_path: Optional[str] = None, restore_session: Optional[bool] = None) -> Union[ClaudeCodeAIBrain, DummyAIBrain]:
    """
    AI Brain ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì´ˆê¸°í™” (v2.0)
    
    Args:
        project_path: í”„ë¡œì íŠ¸ ê²½ë¡œ
        restore_session: ì„¸ì…˜ ë³µì› ì—¬ë¶€
    
    Returns:
        AI Brain ì¸ìŠ¤í„´ìŠ¤
    """
    try:
        print("ğŸ¤– AI Brain v2.0 ì‹œì‘...")
        print("   â€¢ Context Manager v2.0 í†µí•©")
        print("   â€¢ Vibe Memory System v2.0 í†µí•©")
        
        # í”„ë¡œì íŠ¸ ê²½ë¡œ ì„¤ì •
        if not project_path:
            project_path = os.path.dirname(os.path.abspath(__file__))
        
        # AI Brain ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        brain = ClaudeCodeAIBrain(project_path=project_path)
        
        # ì´ˆê¸°í™”
        force_reinit = restore_session is None
        success = brain.auto_initialize(project_path=project_path, force_reinit=force_reinit)
        
        if success:
            print("âœ… ClaudeCodeAIBrain v2.0 ì´ˆê¸°í™” ì„±ê³µ!")
            
            # ì´ˆê¸°í™” ìƒíƒœ ìš”ì•½
            if brain.project_context:
                print(f"   â€¢ ì„¸ì…˜ ID: {brain.project_context.get('session_id', 'unknown')[:8]}...")
                print(f"   â€¢ í”„ë¡œì íŠ¸: {brain.project_context.get('project_name', 'unknown')}")
                
                if brain.vibe_commands:
                    print("   â€¢ Vibe Commands: í™œì„±í™”")
                
                if CONTEXT_MANAGER_AVAILABLE:
                    summary = get_work_tracking_summary(brain.project_context)
                    total_files = summary.get('total_files_accessed', 0)
                    if total_files > 0:
                        print(f"   â€¢ ì‘ì—… ì¶”ì : {total_files}ê°œ íŒŒì¼")
            
            return brain
        else:
            print("âš ï¸ ClaudeCodeAIBrain ì´ˆê¸°í™” ë¶€ë¶„ ì‹¤íŒ¨ - ê¸°ë³¸ ëª¨ë“œ")
            return brain
            
    except Exception as e:
        print(f"âŒ ClaudeCodeAIBrain ìƒì„± ì‹¤íŒ¨: {e}")
        
        # ë”ë¯¸ ê°ì²´ ë°˜í™˜
        try:
            dummy_brain = DummyAIBrain(project_path=project_path)
            print("â„¹ï¸ ë”ë¯¸ AI Brain ê°ì²´ ìƒì„±ë¨")
            return dummy_brain
        except:
            # ìµœì•…ì˜ ê²½ìš° ê¸°ë³¸ ë”ë¯¸ ê°ì²´
            return DummyAIBrain()


def claude_code_bootstrap():
    """execute_code ì²« ì‹¤í–‰ì‹œ ìë™ ë¶€íŠ¸ìŠ¤íŠ¸ë©"""
    print("ğŸš€ í´ë¡œë“œì½”ë“œ AI Brain v2.0 ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‹œì‘...")
    
    # AI Brain ìƒì„± ë° ì´ˆê¸°í™”
    brain = create_ai_brain()
    
    # ê¸€ë¡œë²Œ ë³€ìˆ˜ ì„¤ì •
    if brain and brain.initialized:
        globals()['ai_brain'] = brain
        print("âœ… AI Brainì´ ê¸€ë¡œë²Œ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨")
        
        # ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ ì•ˆë‚´
        print("\nğŸ“Œ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:")
        print("   â€¢ ai_brain.process_vibe_command('/task \"ì‘ì—… ë‚´ìš©\"')")
        print("   â€¢ ai_brain.save_experience('ê²½í—˜ ë‚´ìš©')")
        print("   â€¢ ai_brain.search_solutions('ê²€ìƒ‰ì–´')")
        print("   â€¢ ai_brain.get_insights()")
        print("   â€¢ ai_brain.save_session()")
    
    print("\nâœ… ë¶€íŠ¸ìŠ¤íŠ¸ë© ì™„ë£Œ!")


# í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
def test_ai_brain_v2():
    """AI Brain v2.0 í†µí•© í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*70)
    print("ğŸ§ª AI Brain v2.0 í†µí•© í…ŒìŠ¤íŠ¸")
    print("="*70)
    
    # 1. AI Brain ìƒì„±
    print("\n1ï¸âƒ£ AI Brain ìƒì„± í…ŒìŠ¤íŠ¸...")
    brain = create_ai_brain()
    
    if not brain or not brain.initialized:
        print("âŒ AI Brain ìƒì„± ì‹¤íŒ¨")
        return False
    
    print("âœ… AI Brain ìƒì„± ì„±ê³µ")
    
    # 2. Vibe ëª…ë ¹ì–´ í…ŒìŠ¤íŠ¸
    if hasattr(brain, 'process_vibe_command'):
        print("\n2ï¸âƒ£ Vibe ëª…ë ¹ì–´ í…ŒìŠ¤íŠ¸...")
        
        test_commands = [
            ('/task "AI Brain v2.0 í…ŒìŠ¤íŠ¸"', "ì‘ì—… ì¶”ê°€"),
            ('/focus "í…ŒìŠ¤íŠ¸ ë‹¨ê³„"', "í¬ì»¤ìŠ¤ ì„¤ì •"),
            ('/flow', "í˜„ì¬ ìƒíƒœ í™•ì¸"),
            ('/stats', "í†µê³„ í™•ì¸")
        ]
        
        for cmd, desc in test_commands:
            print(f"\n   â€¢ {desc}: {cmd}")
            try:
                result = brain.process_vibe_command(cmd)
                print(f"     â†’ ê²°ê³¼: {result[:100]}..." if len(result) > 100 else f"     â†’ ê²°ê³¼: {result}")
            except Exception as e:
                print(f"     â†’ ì˜¤ë¥˜: {e}")
    
    # 3. ê²½í—˜ ì €ì¥ í…ŒìŠ¤íŠ¸
    if hasattr(brain, 'save_experience'):
        print("\n3ï¸âƒ£ ê²½í—˜ ì €ì¥ í…ŒìŠ¤íŠ¸...")
        try:
            brain.save_experience({
                'task': 'AI Brain v2.0 í…ŒìŠ¤íŠ¸',
                'solution': 'ë¦¬íŒ©í† ë§ëœ ëª¨ë“ˆ êµ¬ì¡°ë¡œ ì„±ê³µì ìœ¼ë¡œ í†µí•©',
                'tech_stack': ['Python', 'Context Manager', 'Vibe Memory']
            })
            print("   âœ… ê²½í—˜ ì €ì¥ ì„±ê³µ")
        except Exception as e:
            print(f"   âŒ ê²½í—˜ ì €ì¥ ì‹¤íŒ¨: {e}")
    
    # 4. ì„¸ì…˜ ì €ì¥ í…ŒìŠ¤íŠ¸
    print("\n4ï¸âƒ£ ì„¸ì…˜ ì €ì¥ í…ŒìŠ¤íŠ¸...")
    try:
        success = brain.save_session()
        print(f"   {'âœ…' if success else 'âŒ'} ì„¸ì…˜ ì €ì¥ {'ì„±ê³µ' if success else 'ì‹¤íŒ¨'}")
    except Exception as e:
        print(f"   âŒ ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜: {e}")
    
    print("\n" + "="*70)
    print("âœ… AI Brain v2.0 í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("="*70)
    
    return True


# ë©”ì¸ ì‹¤í–‰
if __name__ == "__main__":
    print("\nğŸ¤– Claude Code AI Brain v2.0")
    print("   ë¦¬íŒ©í† ë§ëœ ëª¨ë“ˆ êµ¬ì¡° í†µí•© ì™„ë£Œ")
    print("   - Context Manager v2.0")
    print("   - Vibe Memory System v2.0")
    
    # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    test_ai_brain_v2()
