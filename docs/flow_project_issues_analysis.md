"# flow_project 문제점 분석 보고서\n\n## 📅 작성일: 2025-01-05\n## 🔍 분석 대상: ai-coding-brain-mcp 프로젝트의 flow_project 함수\n\n---\n\n## 1. 🚨 발생한 문제들\n\n### 1.1 주요 에러 메시지\n1. **NoneType 에러**\n   - `AttributeError: 'NoneType' object has no attribute 'get'`\n   - 발생 위치: 실행 중 line 48\n   - 원인: 함수가 None을 반환하거나 변수가 제대로 초기화되지 않음\n\n2. **Git 상태 인식 실패**\n   - Git 브랜치가 'unknown'으로 표시\n   - Git 상태 명령이 제대로 실행되지 않거나 결과 파싱 실패\n\n3. **HelperResult 접근 오류**\n   - `TypeError: 'HelperResult' object is not subscriptable`\n   - 원인: 객체를 딕셔너리처럼 접근하려 했으나, .data 속성을 통해 접근해야 함\n\n4. **문자열 속성 접근 오류**\n   - `AttributeError: 'str' object has no attribute 'get'`\n   - 원인: 문자열을 딕셔너리로 착각하고 .get() 메서드 호출\n\n---\n\n## 2. 🔧 관련 파일 상태\n\n### 2.1 존재하는 파일들\n- ✅ `python/workflow/commands.py` (11,468 bytes)\n- ✅ `python/workflow/workflow_manager.py` (9,362 bytes)\n- ✅ `python/core/context_manager.py` (12,028 bytes)\n- ✅ `python/ai_helpers/__init__.py` (4,521 bytes)\n  - cmd_flow_with_context 함수 포함\n  - flow_project 함수 포함\n\n### 2.2 누락된 파일\n- ❌ `file_system_helpers_v23.py` (없음)\n  - 이 파일이 없어도 실행되는 것으로 보아 다른 헬퍼가 사용되는 듯\n\n---\n\n## 3. 🔍 문제 발생 시나리오\n\n### 실행 흐름\n1. `flow_project('ai-coding-brain-mcp')` 호출\n2. 프로젝트 디렉토리 확인 및 전환\n3. Git 상태 점검 시도 → **실패** (브랜치: unknown)\n4. 워크플로우 데이터 로드 시도\n5. 컨텍스트 정보 접근 시도\n6. **NoneType 에러 발생** → 프로세스 중단\n\n### 워크플로우 파일 상태\n- `memory/workflow.json` - 존재 ✅\n- `memory/workflow_data.json` - 존재 ✅\n- 파일은 존재하지만 데이터 접근 시 문제 발생\n\n---\n\n## 4. 🎯 근본 원인 분석\n\n### 4.1 프록시 패턴 문제\n- 최근 커밋(600a844)에서 `cmd_flow_with_context` 프록시 추가\n- 프록시가 제대로 원본 함수를 호출하지 못하는 것으로 추정\n\n### 4.2 데이터 타입 불일치\n- 함수가 반환하는 데이터 타입과 호출하는 코드가 기대하는 타입 불일치\n- HelperResult 객체를 딕셔너리처럼 접근하려는 시도\n\n### 4.3 Git 통합 문제\n- Git 명령 실행 실패 또는 결과 파싱 로직 문제\n- subprocess 호출은 성공하지만 helpers를 통한 호출은 실패\n\n---\n\n## 5. 💡 해결 방안\n\n### 5.1 즉시 조치사항\n1. **에러 핸들링 강화**\n   - None 체크 추가\n   - try-except 블록으로 에러 캐치\n\n2. **데이터 접근 방식 통일**\n   - HelperResult는 항상 .data 속성으로 접근\n   - hasattr()로 속성 존재 확인\n\n3. **Git 상태 확인 로직 개선**\n   - subprocess 직접 사용 또는\n   - Git 헬퍼 함수 디버깅\n\n### 5.2 장기 개선사항\n1. **타입 힌트 추가**\n   - 함수 반환값과 파라미터에 타입 명시\n   - mypy 등으로 타입 체크\n\n2. **통합 테스트 작성**\n   - flow_project 전체 흐름 테스트\n   - 각 단계별 단위 테스트\n\n3. **로깅 강화**\n   - 각 단계별 상세 로그 추가\n   - 에러 발생 시 컨텍스트 정보 기록\n\n---\n\n## 6. 🔄 현재 우회 방법\n\nflow_project 대신 다음 방법 사용 가능:\n```python\n# 1. 수동으로 디렉토리 변경\nos.chdir('/path/to/project')\n\n# 2. Git 상태는 subprocess로 직접 확인\nsubprocess.check_output(['git', 'status'])\n\n# 3. 워크플로우는 파일 직접 읽기\nwith open('memory/workflow.json') as f:\n    workflow_data = json.load(f)\n```\n\n---\n\n## 7. 📊 영향도 평가\n\n- **심각도**: 중간 (프로젝트 전환 기능 사용 불가)\n- **영향 범위**: flow_project 함수 사용하는 모든 워크플로우\n- **우선순위**: 높음 (핵심 기능)\n\n---\n\n## 8. 🎬 다음 단계\n\n1. **즉시**: 에러 핸들링 코드 추가\n2. **단기**: Git 헬퍼 함수 디버깅 및 수정\n3. **중기**: 전체 flow 로직 리팩토링\n4. **장기**: 타입 시스템 도입 및 테스트 커버리지 향상\n"